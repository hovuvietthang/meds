<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEDS-TRIAL ‚Ä¢ ƒêƒÉng k√Ω & Tra c·ª©u li√™n k·∫øt</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      /* üé® M√†u th∆∞∆°ng hi·ªáu (ƒë·ªìng b·ªô logo/UI) */
      --meds-primary:#2563eb; --meds-dark:#1e40af; --meds-accent:#06b6d4;
      --meds-text:#0f172a; --meds-bg:#0b1220;   /* ƒë·ªïi n·ªÅn base t·ªëi cho vibe startup */
      --meds-border:#1f2a44; --surface:#0f172aE6; /* glass surface */
      --meds-info-bg:#0b1120; --meds-info-br:#1e3a8a;
      --meds-ok-bg:#052e2a;  --meds-ok-br:#2dd4bf;
      --meds-new-bg:#3a1a01; --meds-new-br:#f59e0b;

      /* Logo */
      --logo-max:340px; --logo-nudge:20px;
    }

    /* ======= N·ªÄN STARTUP: gradient + aurora + grid ======= */
    body{ background: var(--meds-bg); color: #e5e7eb; }

    .scene {
      position: fixed; inset: 0; z-index: -2; pointer-events: none;
      background:
        radial-gradient(60% 40% at 15% 10%, rgba(37,99,235,.30) 0%, transparent 60%),
        radial-gradient(50% 35% at 85% 15%, rgba(6,182,212,.25) 0%, transparent 60%),
        radial-gradient(70% 50% at 50% 95%, rgba(30,64,175,.35) 0%, transparent 70%),
        linear-gradient(180deg, #0b1220 0%, #0b1120 30%, #0b1220 100%);
      filter: saturate(1.1);
    }
    .grid {
      position: fixed; inset: 0; z-index: -1; pointer-events: none;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.05) 1px, transparent 1px);
      background-size: 24px 24px;
      mask-image: radial-gradient(60% 60% at 50% 40%, rgba(0,0,0,.9), rgba(0,0,0,0));
      opacity: .5;
    }
    .aurora, .aurora::before, .aurora::after{
      position: fixed; inset: 0; pointer-events: none;
      filter: blur(36px);
      mix-blend-mode: screen;
    }
    .aurora{
      z-index: -1;
      background:
        radial-gradient(30% 30% at 10% 20%, rgba(37,99,235,.25), transparent 60%),
        radial-gradient(25% 30% at 90% 10%, rgba(6,182,212,.20), transparent 60%),
        radial-gradient(20% 25% at 80% 85%, rgba(59,130,246,.18), transparent 60%);
      animation: float 18s ease-in-out infinite alternate;
    }
    .aurora::before{
      content:"";
      background: radial-gradient(28% 28% at 30% 85%, rgba(99,102,241,.20), transparent 60%);
      animation: float2 22s ease-in-out infinite alternate;
    }
    .aurora::after{
      content:"";
      background: radial-gradient(22% 22% at 75% 55%, rgba(59,130,246,.18), transparent 60%);
      animation: float3 26s ease-in-out infinite alternate;
    }
    @keyframes float   { from{transform:translateY(-6px)} to{transform:translateY(6px)} }
    @keyframes float2  { from{transform:translateX(-8px)} to{transform:translateX(8px)} }
    @keyframes float3  { from{transform:translate(6px,-4px)} to{transform:translate(-6px,4px)} }

    /* ======= Logo ======= */
    .logo-wrap { filter: drop-shadow(0 8px 22px rgba(14,165,233,.20)); }
    .logo-svg {
      width: 100%; height: auto; max-width: var(--logo-max);
      display:block; margin-inline:auto;
    }
    .logo-visual { transform-box:view-box; transform-origin:50% 50%; transform:translateX(var(--logo-nudge)); }

    /* ======= Card glass ======= */
    .glass {
      background: var(--surface);
      backdrop-filter: blur(14px);
      border: 1px solid var(--meds-border);
      box-shadow:
        0 10px 30px rgba(2,6,23,.35),
        0 1px 0 0 rgba(255,255,255,.04) inset;
      color:#e5e7eb;
    }
    .glass a{ color:#93c5fd; }
    .glass .input {
      background: rgba(2,6,23,.45);
      color:#e5e7eb;
      border-color: #21314f;
    }
    .glass .input:focus{
      border-color: var(--meds-primary);
      box-shadow: 0 0 0 4px rgba(37,99,235,.18);
      outline: none;
    }

    /* Result badge colors */
    .badge-old{ border-color:var(--meds-ok-br); background:var(--meds-ok-bg); color:#99f6e4; }
    .badge-new{ border-color:var(--meds-new-br); background:var(--meds-new-bg); color:#fdba74; }
  </style>
</head>

<body class="min-h-screen text-[var(--meds-text)]">
  <!-- N·ªÅn startup -->
  <div class="scene" aria-hidden="true"></div>
  <div class="aurora" aria-hidden="true"></div>
  <div class="grid" aria-hidden="true"></div>

  <main class="mx-auto w-full max-w-xl px-4 py-10">
    <!-- Header + Logo -->
    <header class="mb-8 text-center">
      <div class="logo-wrap mx-auto mb-4 flex justify-center">
        <svg class="logo-svg" viewBox="0 0 900 260" preserveAspectRatio="xMidYMid meet"
             xmlns="http://www.w3.org/2000/svg" aria-labelledby="title desc" role="img">
          <title id="title">MedS Logo</title><desc id="desc">MedS logo</desc>
          <defs>
            <filter id="ds" x="-20%" y="-20%" width="140%" height="140%">
              <feOffset dx="0" dy="4" in="SourceAlpha" result="off"/><feGaussianBlur in="off" stdDeviation="6" result="blur"/>
              <feColorMatrix in="blur" type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 0 .22 0" result="shadow"/><feBlend in="SourceGraphic" in2="shadow" mode="normal"/>
            </filter>
            <linearGradient id="gShield" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="var(--meds-primary)"/><stop offset="100%" stop-color="var(--meds-dark)"/>
            </linearGradient>
            <linearGradient id="gHead" x1="0" y1="0" x2="1" y2="0">
              <stop offset="0%" stop-color="var(--meds-primary)"/><stop offset="100%" stop-color="#3b82f6"/>
            </linearGradient>
          </defs>
          <g class="logo-visual">
            <g transform="translate(20,20)" filter="url(#ds)">
              <path d="M100,0 L200,30 L200,120 C200,170 160,210 100,240 C40,210 0,170 0,120 L0,30 Z" fill="url(#gShield)"/>
              <g transform="translate(35,40)">
                <rect x="0" y="18" rx="10" ry="10" width="130" height="110" fill="white" opacity="0.96"/>
                <rect x="0" y="18" width="130" height="28" rx="10" ry="10" fill="url(#gHead)"/>
                <circle cx="28" cy="18" r="6.5" fill="white"/><circle cx="102" cy="18" r="6.5" fill="white"/>
                <g fill="#d1d5db">
                  <rect x="12" y="56" width="18" height="16" rx="3"/><rect x="36" y="56" width="18" height="16" rx="3"/>
                  <rect x="60" y="56" width="18" height="16" rx="3"/><rect x="84" y="56" width="18" height="16" rx="3"/>
                  <rect x="12" y="78" width="18" height="16" rx="3"/><rect x="36" y="78" width="18" height="16" rx="3"/>
                  <rect x="60" y="78" width="18" height="16" rx="3"/><rect x="84" y="78" width="18" height="16" rx="3"/>
                  <rect x="12" y="100" width="18" height="16" rx="3"/><rect x="36" y="100" width="18" height="16" rx="3"/>
                  <rect x="60" y="100" width="18" height="16" rx="3"/><rect x="84" y="100" width="18" height="16" rx="3"/>
                </g>
                <g transform="translate(92,92)">
                  <rect x="-10" y="-26" width="20" height="52" rx="3" fill="var(--meds-accent)"/>
                  <rect x="-26" y="-10" width="52" height="20" rx="3" fill="var(--meds-accent)"/>
                </g>
              </g>
            </g>
            <g transform="translate(280,150)">
              <text x="0" y="0" font-family="Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-weight="800" font-size="90" fill="#e5e7eb">MED</text>
              <text x="210" y="0" font-family="Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-weight="900" font-size="96" fill="var(--meds-primary)">S+</text>
            </g>
          </g>
        </svg>
      </div>
      <p class="mt-1 text-sm text-slate-300">Nh·∫≠p <strong>H·ªç t√™n</strong> v√† <strong>S·ªë ƒëi·ªán tho·∫°i</strong> ƒë·ªÉ <em>ƒëƒÉng k√Ω ho·∫∑c tra c·ª©u li√™n k·∫øt truy c·∫≠p</em>.</p>
    </header>

    <section class="glass rounded-2xl p-6">
      <form id="trialForm" class="space-y-5">
        <div>
          <label for="hoten" class="mb-1.5 block text-sm font-medium text-slate-200">H·ªç v√† t√™n</label>
          <input id="hoten" name="hoten" type="text" required placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A"
                 class="input w-full rounded-xl border px-4 py-2.5 text-sm">
        </div>

        <div>
          <label for="sdt" class="mb-1.5 block text-sm font-medium text-slate-200">S·ªë ƒëi·ªán tho·∫°i (Zalo)</label>
          <input id="sdt" name="sdt" type="tel" inputmode="numeric" required placeholder="V√≠ d·ª•: 0901234567"
                 class="input w-full rounded-xl border px-4 py-2.5 text-sm">
          <p class="mt-1 text-xs text-slate-400">G·ª£i √Ω: Qu√™n t√†i kho·∫£n? Nh·∫≠p <strong>SƒêT ƒë√£ ƒëƒÉng k√Ω</strong> ƒë·ªÉ tra c·ª©u li√™n k·∫øt.</p>
        </div>

        <div class="flex items-center gap-3 pt-2">
          <button id="submitBtn" type="submit"
                  class="inline-flex items-center gap-2 rounded-xl bg-[var(--meds-primary)] px-4 py-2.5 text-sm font-semibold text-white shadow hover:bg-[var(--meds-dark)] focus:outline-none focus:ring-2 focus:ring-[color:rgba(37,99,235,.25)] disabled:opacity-60">
            <svg id="spinner" class="hidden h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 0 1 8-8v4A4 4 0 0 0 8 12H4z"></path>
            </svg>
            <span>Nh·∫≠n li√™n k·∫øt</span>
          </button>
          <span id="statusText" class="text-sm text-slate-300"></span>
        </div>

        <!-- Error -->
        <div id="errorBox" class="hidden rounded-xl border border-red-500/30 bg-red-500/10 px-4 py-3 text-sm text-red-300"></div>

        <!-- Result -->
        <div id="resultBox" class="hidden rounded-2xl border border-[var(--meds-info-br)] bg-[color:rgba(30,58,138,.35)] p-4 backdrop-blur">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
            <div class="min-w-0">
              <p class="text-sm font-medium text-slate-200">Li√™n k·∫øt truy c·∫≠p ‚Ä¢ M·∫≠t kh·∫©u: <span class="font-semibold">meds</span></p>
              <a id="deployLink" href="#" target="_blank" rel="noopener" class="block truncate text-sm text-blue-300 underline">ƒêang x·ª≠ l√Ω‚Ä¶</a>
              <span id="modeBadge" class="mt-1 inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold"></span>
            </div>
            <div class="mt-2 flex shrink-0 gap-2 sm:mt-0">
              <button type="button" id="openBtn" class="rounded-xl border border-[var(--meds-border)] bg-white/5 px-3 py-2 text-sm font-medium text-slate-200 hover:bg-white/10">
                M·ªü li√™n k·∫øt
              </button>
              <button type="button" id="copyBtn" class="rounded-xl bg-[var(--meds-primary)] px-3 py-2 text-sm font-semibold text-white hover:bg-[var(--meds-dark)]">
                Sao ch√©p
              </button>
            </div>
          </div>
        </div>
      </form>
    </section>

    <footer class="mt-8 text-center text-xs text-slate-400">
      ¬© <span id="y"></span> MEDS ‚Ä¢ Ph√°t tri·ªÉn b·ªüi LTP Co., Ltd.
    </footer>
  </main>

  <script>
    // üîó THAY B·∫∞NG URL /exec C·ª¶A APPS SCRIPT (Phi√™n b·∫£n A)
    const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbwUG-n6YMUr1VLuOMGQifSH0rH285pS92GY1PlefVQYSQlmJjWNs2fRSy7JHlyEX1bI/exec';

    const normalizePhone = s => String(s || '').replace(/\D/g,'');
    const isValidPhone = d => /^\d{9,12}$/.test(d);
    const $ = sel => document.querySelector(sel);
    const show = (el, yes=true) => el.classList.toggle('hidden', !yes);

    async function dangKyTrial(hoten, sdt){
      try{
        const res = await fetch(WEBAPP_URL, {
          method:'POST',
          headers:{ 'Content-Type':'text/plain;charset=utf-8' },
          body: JSON.stringify({ hoten, sdt }),
          cache:'no-store', redirect:'follow'
        });
        return await res.json();
      }catch(_){
        const url = WEBAPP_URL + '?hoten=' + encodeURIComponent(hoten) + '&sdt=' + encodeURIComponent(sdt);
        const res2 = await fetch(url, { method:'GET', cache:'no-store' });
        return await res2.json();
      }
    }

    $('#trialForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const hoten = $('#hoten').value.trim();
      const sdt = normalizePhone($('#sdt').value.trim());
      const status = $('#statusText'), errorBx = $('#errorBox'), result = $('#resultBox');
      const submit = $('#submitBtn'), spinner = $('#spinner');

      show(errorBx,false); show(result,false); status.textContent='';
      if(!hoten){ errorBx.textContent='Vui l√≤ng nh·∫≠p h·ªç v√† t√™n.'; return show(errorBx,true); }
      if(!isValidPhone(sdt)){ errorBx.textContent='S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (vui l√≤ng nh·∫≠p 9‚Äì12 ch·ªØ s·ªë).'; return show(errorBx,true); }

      submit.disabled=true; show(spinner,true); status.textContent='ƒêang x·ª≠ l√Ω y√™u c·∫ßu‚Ä¶';

      try{
        const data = await dangKyTrial(hoten, sdt);
        if(data?.success){
          const link = data.link || '#', mode = data.mode;
          const a = $('#deployLink'), badge = $('#modeBadge');
          a.href = link; a.textContent = link;

          const isOld = mode === 'exists';
          badge.textContent = isOld ? 'ƒê√É ƒêƒÇNG K√ù' : 'V·ª™A C·∫§P M·ªöI';
          badge.className = 'mt-1 inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold ' +
            (isOld ? 'badge-old' : 'badge-new');

          show(result,true);
          status.textContent = isOld ? 'Tra c·ª©u th√†nh c√¥ng.' : 'ƒêƒÉng k√Ω th√†nh c√¥ng.';
        }else{
          throw new Error(data?.error || 'Kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu.');
        }
      }catch(err){
        errorBx.textContent = err.message || String(err);
        show(errorBx,true);
        status.textContent='';
      }finally{
        submit.disabled=false; show(spinner,false);
      }
    });

    $('#openBtn').addEventListener('click', ()=>{ const href=$('#deployLink').href; if(href) window.open(href,'_blank','noopener'); });
    $('#copyBtn').addEventListener('click', async ()=>{
      const href = $('#deployLink').href || '';
      try{ await navigator.clipboard.writeText(href); alert('ƒê√£ sao ch√©p li√™n k·∫øt.'); }
      catch{ alert('Kh√¥ng th·ªÉ sao ch√©p. Vui l√≤ng copy th·ªß c√¥ng.'); }
    });

    $('#y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
